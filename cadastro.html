<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cadastro com CEP</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Cadastro de usuários</h1>
  </header>

  <main>
    <form method="post" action="confirmar_cadastro.php">
      <fieldset>
        <legend>Dados Pessoais</legend>
        <label>Nome Completo:</label>
        <input type="text" id="nome" name="nome" required><br>

        <label>E-mail:</label>
        <input type="email" required id="email" name="email"   autocomplete="off"><br>

        <label>Senha:</label>
        <input type="password" required id="senha" name="senha" autocomplete="off"><br><br>
      </fieldset>

      <br>

      <fieldset>
        <legend>Cadastro do Endereço</legend><br>

        <label for="cep">CEP:</label>
        <input type="text" id="cep" name="cep" maxlength="9" required><br>

        <label>Endereço:</label>
        <input type="text" id="endereco" name="endereco" required><br>

        <label>Número:</label>
        <input type="text" id="numero" name="numero" required maxlength="5"><br>

        <label>Bairro:</label>
        <input type="text" id="bairro" name="bairro" required><br>

        <label>Cidade:</label>
        <input type="text" id="cidade" name="cidade" required><br>

        <label>Estado:</label>
        <input type="text" id="estado" name="estado" required><br>
      </fieldset>

      <button type="submit">Cadastrar</button>
    </form>
  </main>

  <script>
    // Função para buscar o CEP no ViaCEP
    document.getElementById("cep").addEventListener("blur", function() {
      let cep = this.value.replace(/\D/g, ''); // remove caracteres não numéricos

      if (cep.length === 8) {
        fetch(`https://viacep.com.br/ws/${cep}/json/`)
          .then(response => response.json())
          .then(data => {
            if (!("erro" in data)) {
              document.getElementById("endereco").value = data.logradouro || "";
              document.getElementById("bairro").value   = data.bairro || "";
              document.getElementById("cidade").value   = data.localidade || "";
              document.getElementById("estado").value   = data.uf || "";
            } else {
              alert("CEP não encontrado!");
            }
          })
          .catch(error => {
            alert("Erro ao consultar o CEP!");
            console.error(error);
          });
      }
    });
  </script>

  <script>
  // Função para pegar parâmetros da URL
  function getParam(name) {
    const url = new URL(window.location.href);
    return url.searchParams.get(name) || "";
  }

  // Preenche os campos com os dados recebidos
  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("nome").value     = getParam("nome");
    document.getElementById("email").value    = getParam("email");
    document.getElementById("cep").value      = getParam("cep");
    document.getElementById("endereco").value = getParam("endereco");
    document.getElementById("numero").value   = getParam("numero");
    document.getElementById("bairro").value   = getParam("bairro");
    document.getElementById("cidade").value   = getParam("cidade");
    document.getElementById("estado").value   = getParam("estado");
  });
</script>

</body>
</html>
